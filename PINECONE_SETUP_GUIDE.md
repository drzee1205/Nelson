# 🌲 Nelson Pediatrics Pinecone Setup Guide

This guide will help you upload your processed Nelson Pediatrics data to Pinecone vector database for fast similarity search.

## 🚀 Quick Start

### 1. Install Dependencies

```bash
pip install -r requirements.txt
```

### 2. Set Up Pinecone Credentials

```bash
export PINECONE_API_KEY="your-pinecone-api-key"
export PINECONE_ENVIRONMENT="us-east-1-aws"  # Optional, defaults to us-east-1-aws
```

### 3. Process Data (if not done already)

```bash
python process_data_locally.py
```

### 4. Upload to Pinecone

```bash
python upload_to_pinecone.py
```

## 📋 Prerequisites

### Get Pinecone API Key

1. Go to [Pinecone Console](https://app.pinecone.io/)
2. Sign up or log in to your account
3. Create a new project or use existing one
4. Copy your API key from the dashboard
5. Note your environment (usually `us-east-1-aws` for free tier)

### Processed Data File

Make sure you have the `nelson_pediatrics_processed.jsonl` file:
- Generated by running `python process_data_locally.py`
- Contains ~15,339 text chunks with 384-dimensional embeddings
- File size: ~101MB

## 🔧 Configuration Options

### Index Settings

The script creates a Pinecone index with these settings:

```python
INDEX_NAME = "nelson-pediatrics"
DIMENSION = 384  # all-MiniLM-L6-v2 embedding dimension
METRIC = "cosine"  # Distance metric for similarity
```

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `PINECONE_API_KEY` | Your Pinecone API key | **Required** |
| `PINECONE_ENVIRONMENT` | Pinecone environment | `us-east-1-aws` |

## 📊 What Gets Uploaded

Each vector in Pinecone contains:

### Vector Data
- **ID**: `nelson_{source_file}_{chunk_number}`
- **Values**: 384-dimensional embedding array
- **Metadata**: Rich metadata for filtering and display

### Metadata Structure
```json
{
  "source_file": "The Respiratory System.txt",
  "topic": "The Respiratory System",
  "chunk_number": 1,
  "character_count": 987,
  "text": "First 1000 characters of the text...",
  "created_at": "2025-08-01T17:35:04Z",
  "file_size": 1412925,
  "total_chunks": 45,
  "embedding_model": 384
}
```

## 🔍 Similarity Search Example

After uploading, you can perform similarity searches:

```python
import pinecone
from sentence_transformers import SentenceTransformer

# Initialize
pc = pinecone.Pinecone(api_key="your-api-key")
index = pc.Index("nelson-pediatrics")
model = SentenceTransformer('all-MiniLM-L6-v2')

# Search
query = "asthma treatment in children"
query_embedding = model.encode([query])[0].tolist()

results = index.query(
    vector=query_embedding,
    top_k=5,
    include_metadata=True
)

# Process results
for match in results['matches']:
    print(f"Score: {match['score']:.3f}")
    print(f"Topic: {match['metadata']['topic']}")
    print(f"Text: {match['metadata']['text'][:200]}...")
    print("-" * 50)
```

## 📈 Expected Results

After successful upload:

- **📊 Total Vectors**: ~15,339 medical text chunks
- **🧠 Dimension**: 384 (optimized for fast search)
- **🏷️ Topics**: ~23 medical topics from source files
- **🔍 Search Ready**: Instant similarity search capabilities
- **💾 Storage**: Efficient vector storage in Pinecone cloud

## 🛠️ Troubleshooting

### Common Issues

1. **API Key Error**
   ```
   ❌ PINECONE_API_KEY environment variable not set!
   ```
   **Solution**: Set your API key with `export PINECONE_API_KEY="your-key"`

2. **Index Already Exists**
   ```
   📋 Index 'nelson-pediatrics' already exists
   ```
   **Solution**: This is normal - the script will use the existing index

3. **Dimension Mismatch**
   ```
   ❌ Vector dimension doesn't match index dimension
   ```
   **Solution**: Ensure you're using the same embedding model (all-MiniLM-L6-v2)

4. **Rate Limiting**
   ```
   ❌ Rate limit exceeded
   ```
   **Solution**: The script includes automatic batching to avoid rate limits

### Data File Issues

1. **File Not Found**
   ```
   ❌ File nelson_pediatrics_processed.jsonl not found!
   ```
   **Solution**: Run `python process_data_locally.py` first

2. **Invalid JSON**
   ```
   ⚠️ Skipping invalid JSON on line X
   ```
   **Solution**: This is usually fine - the script skips corrupted lines

## 🔒 Security Best Practices

1. **Environment Variables**: Never commit API keys to version control
2. **Access Control**: Use Pinecone's access controls for production
3. **API Key Rotation**: Regularly rotate your API keys
4. **Network Security**: Use HTTPS for all API calls (handled automatically)

## 💰 Cost Considerations

### Pinecone Pricing (as of 2024)

- **Free Tier**: 1 index, 100K vectors, 10GB storage
- **Starter**: $70/month for 5M vectors
- **Standard**: Custom pricing for larger deployments

### Our Dataset
- **Vectors**: ~15,339 (well within free tier)
- **Storage**: ~60MB vector data + metadata
- **Queries**: Unlimited similarity searches

## 🚀 Next Steps

After successful upload:

1. **Build Search API**: Create REST endpoints for medical content search
2. **Web Interface**: Build a user-friendly search interface
3. **Advanced Filtering**: Use metadata for topic-specific searches
4. **Hybrid Search**: Combine vector similarity with keyword search
5. **Analytics**: Track search patterns and popular queries

## 🔗 Useful Links

- [Pinecone Documentation](https://docs.pinecone.io/)
- [Pinecone Python Client](https://github.com/pinecone-io/pinecone-python-client)
- [Vector Database Guide](https://www.pinecone.io/learn/vector-database/)
- [Similarity Search Best Practices](https://www.pinecone.io/learn/what-is-similarity-search/)

## 📞 Support

If you encounter issues:

1. Check the [Pinecone Status Page](https://status.pinecone.io/)
2. Review the [Pinecone Community](https://community.pinecone.io/)
3. Check your API usage in the Pinecone console
4. Verify your environment and API key settings

---

**Ready to power your medical knowledge base with lightning-fast vector search! 🏥⚡**

